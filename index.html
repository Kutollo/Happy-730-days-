<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>10-Day Fasting & Prayer Guide</title>
<style>
body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#f3f4f6; color:#111; }
.container { max-width: 900px; margin: auto; padding: 20px; }
h1 { text-align: center; margin-bottom: 10px; color:#4f46e5; }
.day-card { background:white; padding:20px; border-radius:15px; margin-bottom:20px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
.prayer-block { display:block; margin:8px 0; font-weight:500; }
textarea { width:100%; height:100px; padding:10px; border-radius:10px; border:1px solid #ccc; margin-top:10px; resize:none; }
canvas { background:#fff; border-radius:15px; padding:10px; margin-top:20px; }
.btn { background:#6366f1; color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; margin-top:10px; }
#timer { text-align:center; font-size:1.2em; font-weight:bold; margin-bottom:15px; color:#111; }
</style>
</head>
<body>
<div class="container">
  <h1>10-Day Fasting & Prayer Smart Guide</h1>
  <div id="timer">Loading timer...</div>
  <div class="day-card">
    <strong id="dayTitle"></strong>
    <p id="dayFocus"></p>
    <div id="prayerBlocks"></div>
    <textarea id="notes" placeholder="Journal notes..."></textarea>
    <button class="btn" onclick="saveNotes()">Save Notes</button>
  </div>
  <canvas id="progressChart" width="800" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const PLAN = [
  { day:1, type:"Water", focus:"Cleansing & repentance", scripture:"Psalm 51:10–12" },
  { day:2, type:"Dry", focus:"Break sexual strongholds", scripture:"1 Thess 4:3–4" },
  { day:3, type:"Water", focus:"Renewed mind & purity", scripture:"Rom 12:1–2" },
  { day:4, type:"Esther", focus:"R60 000 fees breakthrough", scripture:"Esther 4:16" },
  { day:5, type:"Water", focus:"Provision & favour", scripture:"Phil 4:19" },
  { day:6, type:"Dry", focus:"Brother: freedom from alcohol", scripture:"Isa 61:1–3" },
  { day:7, type:"Water", focus:"Family forgiveness & restoration", scripture:"Col 3:13" },
  { day:8, type:"Dry", focus:"Healing from depression", scripture:"Psalm 34:17–18" },
  { day:9, type:"Water", focus:"Thanksgiving & sealing", scripture:"Phil 4:6–7" },
  { day:10, type:"Esther", focus:"Final push for all points", scripture:"Joel 2:12–13" },
];

const PRAYER_BLOCKS = [
  { key:"worship", label:"5:00 Worship + Repent" },
  { key:"noon", label:"12:00 Scripture Declarations" },
  { key:"pm", label:"15:00 Warfare & Binding" },
  { key:"midnight", label:"00:00 Midnight Intercession (optional)" },
];

let startISO = localStorage.getItem('fs_start') || new Date().toISOString().slice(0,10);
let checks = JSON.parse(localStorage.getItem('fs_checks') || '{}');
let notes = localStorage.getItem('fs_notes') || '';

function getCurrentDay() {
  const today = new Date();
  const start = new Date(startISO);
  const diff = Math.floor((today - start)/(1000*60*60*24));
  return Math.min(Math.max(diff,0), PLAN.length-1);
}

function renderDay() {
  const idx = getCurrentDay();
  const day = PLAN[idx];
  document.getElementById('dayTitle').innerText = `Day ${day.day}: ${day.type} Fast`;
  document.getElementById('dayFocus').innerText = day.focus;

  alert(`Today's Scripture: ${day.scripture}`);

  const pbContainer = document.getElementById('prayerBlocks');
  pbContainer.innerHTML = '';
  PRAYER_BLOCKS.forEach(b => {
    const checked = (checks[`d${day.day}`]?.[b.key]) ? 'checked' : '';
    pbContainer.innerHTML += `<label class="prayer-block"><input type="checkbox" onchange="toggleCheck('${b.key}')" ${checked}> ${b.label}</label>`;
  });

  document.getElementById('notes').value = notes;
}

function toggleCheck(key) {
  const day = PLAN[getCurrentDay()].day;
  checks[`d${day}`] = checks[`d${day}`] || {};
  checks[`d${day}`][key] = !checks[`d${day}`][key];
  localStorage.setItem('fs_checks', JSON.stringify(checks));
  renderProgressChart();

  // Confetti if all prayer blocks checked
  if(Object.values(checks[`d${day}`]).filter(v=>v).length === PRAYER_BLOCKS.length){
    confetti({ particleCount: 150, spread: 70, origin:{y:0.6} });
  }
}

function saveNotes() {
  notes = document.getElementById('notes').value;
  localStorage.setItem('fs_notes', notes);
  alert('Notes saved!');
}

function renderProgressChart() {
  const data = PLAN.map(p => {
    const dayChecks = checks[`d${p.day}`] || {};
    const pct = Math.round((Object.values(dayChecks).filter(v=>v).length / PRAYER_BLOCKS.length)*100);
    return { day:`D${p.day}`, completion:pct };
  });

  const ctx = document.getElementById('progressChart').getContext('2d');
  if(window.chart) window.chart.destroy();
  window.chart = new Chart(ctx, {
    type:'line',
    data: {
      labels: data.map(d=>d.day),
      datasets:[{
        label:'Completion %',
        data: data.map(d=>d.completion),
        fill:true,
        backgroundColor:'rgba(99,102,241,0.2)',
        borderColor:'#6366f1',
        tension:0.4
      }]
    },
    options: { responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
  });
}

// Countdown timer
function updateTimer() {
  const now = new Date();
  const start = new Date();
  start.setHours(0,0,0,0);
  const end = new Date();
  end.setHours(17,0,0,0); // 5 PM
  let diff = now<start ? start-now : end-now;
  const hrs = Math.floor(diff/1000/60/60);
  const mins = Math.floor((diff/1000/60)%60);
  const secs = Math.floor((diff/1000)%60);
  const label = now>=start && now<=end ? 'Time left in fast' : 'Time until fast starts';
  document.getElementById('timer').innerText = `${label}: ${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

setInterval(updateTimer, 1000);

renderDay();
renderProgressChart();
</script>
</body>
</html>
