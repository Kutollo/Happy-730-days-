<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>10-Day Fasting & Prayer Guide</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:linear-gradient(135deg,#fef9c3,#dbeafe); color:#111; }
  .container { max-width: 1000px; margin:auto; padding:20px; }
  h1 { text-align:center; color:#4f46e5; margin-bottom:15px; font-size:2rem; }
  #timer { text-align:center; font-size:1.2rem; font-weight:bold; margin-bottom:20px; }
  .day-card, .next-card { background:white; border-radius:20px; padding:25px; box-shadow:0 10px 25px rgba(0,0,0,0.15); margin-bottom:20px; }
  .day-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
  .day-title { font-size:1.5rem; font-weight:700; color:#4f46e5; }
  .verse { background:#eef2ff; padding:10px 15px; border-radius:12px; margin:10px 0; font-weight:500; }
  .prayer-point { background:#fef3c7; padding:10px 15px; border-radius:12px; margin:10px 5px 10px 0; display:inline-block; font-weight:500; }
  .prayer-block { display:block; margin:8px 0; font-weight:500; }
  textarea { width:100%; height:100px; padding:12px; border-radius:12px; border:1px solid #ccc; margin-top:10px; resize:none; }
  .btn { background:#6366f1; color:white; border:none; padding:10px 18px; border-radius:10px; cursor:pointer; margin-top:10px; font-weight:600; }
  canvas { background:white; border-radius:20px; padding:10px; margin-top:20px; }
  @media (max-width:600px){ .day-header{flex-direction:column; align-items:flex-start;} .day-title{margin-bottom:10px;} }
</style>
</head>
<body>
<div class="container">
  <h1>10-Day Fasting & Prayer Guide</h1>
  <div id="timer">Loading timer...</div>
  
  <div class="day-card">
    <div class="day-header">
      <div class="day-title" id="dayTitle"></div>
    </div>
    <p id="dayFocus"></p>
    <div id="verse" class="verse"></div>
    <div id="prayerPoints" class="prayer-point-container"></div>
    <div id="prayerBlocks"></div>
    <textarea id="notes" placeholder="Journal notes..."></textarea>
    <button class="btn" onclick="saveNotes()">Save Notes</button>
  </div>

  <div class="next-card">
    <div class="day-header">
      <div class="day-title" id="nextDayTitle">Next Day Preview</div>
    </div>
    <p id="nextDayFocus"></p>
    <div id="nextVerse" class="verse"></div>
    <div id="nextPrayerPoints" class="prayer-point-container"></div>
  </div>

  <canvas id="progressChart" width="800" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// Start date is tomorrow
let startISO = new Date();
startISO.setDate(startISO.getDate()+1);
startISO = startISO.toISOString().slice(0,10);

const PLAN = [
  { day:1, type:"Water", focus:"Cleansing & repentance", scripture:"Psalm 51:10–12", prayerPoints:["Repent of all sin","Ask for cleansing","Pray for pure heart"] },
  { day:2, type:"Dry", focus:"Break sexual strongholds", scripture:"1 Thess 4:3–4", prayerPoints:["Break lust","Pray for self-control","Resist temptation"] },
  { day:3, type:"Water", focus:"Renewed mind & purity", scripture:"Romans 12:1–2", prayerPoints:["Renew mind","Pray for holiness","Commit to righteousness"] },
  { day:4, type:"Esther", focus:"R60 000 fees breakthrough", scripture:"Esther 4:16", prayerPoints:["Pray for funding","Open financial doors","Trust God's provision"] },
  { day:5, type:"Water", focus:"Provision & favour", scripture:"Philippians 4:19", prayerPoints:["Bless finances","Ask for favour","Receive provision"] },
  { day:6, type:"Dry", focus:"Brother: freedom from alcohol", scripture:"Isaiah 61:1–3", prayerPoints:["Deliver brother","Pray for strength","Break addictions"] },
  { day:7, type:"Water", focus:"Family forgiveness & restoration", scripture:"Colossians 3:13", prayerPoints:["Forgive family","Restore relationships","Pray for unity"] },
  { day:8, type:"Dry", focus:"Healing from depression", scripture:"Psalm 34:17–18", prayerPoints:["Pray for healing","Peace of mind","Joy restoration"] },
  { day:9, type:"Water", focus:"Thanksgiving & sealing", scripture:"Philippians 4:6–7", prayerPoints:["Thank God","Seal breakthroughs","Praise continually"] },
  { day:10, type:"Esther", focus:"Final push for all points", scripture:"Joel 2:12–13", prayerPoints:["Cover all prayers","Pray for victory","Commit fully"] },
];

const PRAYER_BLOCKS = [
  { key:"worship", label:"5:00 Worship + Repent" },
  { key:"noon", label:"12:00 Scripture Declarations" },
  { key:"pm", label:"15:00 Warfare & Binding" },
  { key:"midnight", label:"00:00 Midnight Intercession (optional)" },
];

let checks = JSON.parse(localStorage.getItem('fs_checks') || '{}');
let notes = localStorage.getItem('fs_notes') || '';

function getCurrentDay() {
  const today = new Date();
  const start = new Date(startISO);
  const diff = Math.floor((today - start)/(1000*60*60*24));
  return Math.min(Math.max(diff,0), PLAN.length-1);
}

function renderDay() {
  const idx = getCurrentDay();
  const day = PLAN[idx];
  const nextDay = PLAN[Math.min(idx+1, PLAN.length-1)];
  const todayDate = new Date(startISO);
  todayDate.setDate(todayDate.getDate() + day.day - 1);
  const formattedDate = todayDate.toDateString();

  document.getElementById('dayTitle').innerText = `Day ${day.day}: ${day.type} Fast (${formattedDate})`;
  document.getElementById('dayFocus').innerText = day.focus;
  document.getElementById('verse').innerText = `Verse: ${day.scripture}`;
  document.getElementById('prayerPoints').innerHTML = `Prayer Points:<ul>${day.prayerPoints.map(p=>`<li>${p}</li>`).join('')}</ul>`;

  const pbContainer = document.getElementById('prayerBlocks');
  pbContainer.innerHTML = '';
  PRAYER_BLOCKS.forEach(b => {
    const checked = (checks[`d${day.day}`]?.[b.key]) ? 'checked' : '';
    pbContainer.innerHTML += `<label class="prayer-block"><input type="checkbox" onchange="toggleCheck('${b.key}')" ${checked}> ${b.label}</label>`;
  });
  document.getElementById('notes').value = notes;

  // Next day preview
  document.getElementById('nextDayTitle').innerText = `Day ${nextDay.day}: ${nextDay.type} Fast`;
  document.getElementById('nextDayFocus').innerText = nextDay.focus;
  document.getElementById('nextVerse').innerText = `Verse: ${nextDay.scripture}`;
  document.getElementById('nextPrayerPoints').innerHTML = `Prayer Points:<ul>${nextDay.prayerPoints.map(p=>`<li>${p}</li>`).join('')}</ul>`;
}

function toggleCheck(key) {
  const day = PLAN[getCurrentDay()].day;
  checks[`d${day}`] = checks[`d${day}`] || {};
  checks[`d${day}`][key] = !checks[`d${day}`][key];
  localStorage.setItem('fs_checks', JSON.stringify(checks));
  renderProgressChart();

  if(Object.values(checks[`d${day}`]).filter(v=>v).length === PRAYER_BLOCKS.length){
    confetti({ particleCount: 150, spread: 70, origin:{y:0.6} });
  }
}

function saveNotes() {
  notes = document.getElementById('notes').value;
  localStorage.setItem('fs_notes', notes);
  alert('Notes saved!');
}

function renderProgressChart() {
  const data = PLAN.map(p => {
    const dayChecks = checks[`d${p.day}`] || {};
    const pct = Math.round((Object.values(dayChecks).filter(v=>v).length / PRAYER_BLOCKS.length)*100);
    return { day:`D${p.day}`, completion:pct };
  });

  const ctx = document.getElementById('progressChart').getContext('2d');
  if(window.chart) window.chart.destroy();
  window.chart = new Chart(ctx, {
    type:'line',
    data: {
      labels: data.map(d=>d.day),
      datasets:[{
        label:'Completion %',
        data: data.map(d=>d.completion),
        fill:true,
        backgroundColor:'rgba(99,102,241,0.2)',
        borderColor:'#6366f1',
        tension:0.4
      }]
    },
    options: { responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
  });
}

// Countdown timer 12:00 AM - 5:00 PM
function updateTimer() {
  const now = new Date();
  const start = new Date();
  start.setHours(0,0,0,0);
  const end = new Date();
  end.setHours(17,0,0,0);
  let diff = now<start ? start-now : end-now;
  if(diff<0) diff = 0;
  const hrs = Math.floor(diff/1000/60/60);
  const mins = Math.floor((diff/1000/60)%60);
  const secs = Math.floor((diff/1000)%60);
  const label = now>=start && now<=end ? 'Time left in fast' : 'Time until fast starts';
  document.getElementById('timer').innerText = `${label}: ${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

setInterval(updateTimer,1000);
renderDay();
renderProgressChart();
</script>
</body>
</html>
